<!DOCTYPE html>
{% load static %}
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}AIå®‰å…¨é¶åœº{% endblock %}</title>
    <script>
        // æå‰è®¾ç½®ä¸»é¢˜ï¼Œé¿å…é—ªä¸€ä¸‹ç™½åº•å†åˆ‡æ¢åˆ°æš—è‰²
        (function () {
            try {
                var saved = localStorage.getItem('theme');
                var systemDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                var theme = saved || (systemDark ? 'dark' : 'light');
                document.documentElement.setAttribute('data-theme', theme);
            } catch (e) {
                document.documentElement.setAttribute('data-theme', 'light');
            }
        })();
    </script>
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.3.1/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link href="https://cdn.bootcdn.net/ajax/libs/bootstrap-icons/1.10.5/font/bootstrap-icons.min.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="{% static 'css/style.css' %}" rel="stylesheet">
    <link href="{% static 'css/lab_detail.css' %}" rel="stylesheet">
    <!-- Syntax Highlighting (GitHub style) -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" rel="stylesheet">
    {% block extra_css %}{% endblock %}
</head>
<body>
    <nav class="navbar navbar-expand-md fixed-top">
        <div class="container-fluid px-4">
            <a class="navbar-brand d-flex align-items-center" href="/">
                <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-2">
                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
                    <path d="M9 12l2 2 4-4"></path>
                </svg>
                AIå®‰å…¨é¶åœº
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarCollapse">
                <ul class="navbar-nav me-auto mb-2 mb-md-0">
                    <li class="nav-item">
                        <a class="nav-link {% if '/playground' in request.path %}active{% endif %}"
                           href="{% url 'playground:lab_list' %}">é¶åœºæ¼”ç»ƒ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link {% if request.resolver_match.url_name == 'about' %}active{% endif %}"
                           href="{% url 'learning:about' %}">å…³äºé¶åœº</a>
                    </li>
                </ul>
                <ul class="navbar-nav mb-2 mb-md-0">
                    {% if user.is_authenticated %}
                        <li class="nav-item">
                            <button id="themeToggle" type="button" class="nav-link bg-transparent border-0" aria-label="åˆ‡æ¢ä¸»é¢˜">
                                <span class="theme-icon">ğŸŒ™</span>
                            </button>
                        </li>
                        <li class="nav-item">
                            <span class="nav-link">{{ user.username }}</span>
                        </li>
                        <li class="nav-item">
                            <form action="{% url 'logout' %}" method="post" class="d-inline">
                                {% csrf_token %}
                                <button type="submit" class="nav-link bg-transparent border-0">é€€å‡º</button>
                            </form>
                        </li>
                    {% else %}
                        <li class="nav-item">
                            <a class="nav-link" href="{% url 'login' %}">ç™»å½•</a>
                        </li>
                    {% endif %}
                </ul>
            </div>
        </div>
    </nav>

    <div class="container-fluid p-0">
    <!-- æ¶ˆæ¯æç¤º -->
    {% if messages %}
    <div class="container mt-5 pt-4 messages-container">
        {% for message in messages %}
        <div class="alert alert-{{ message.tags|default:'info' }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
        </div>
        {% endfor %}
    </div>
    {% endif %}
    
    {% block content %}{% endblock %}
</div>

    <!-- å…¨å±€ï¼šé¶åœº LLM é…ç½®å¼¹å±‚ï¼ˆé¶åœºè¯¦æƒ…é¡µã€Œé…ç½® LLMã€ç»Ÿä¸€å…¥å£ï¼‰ -->
    {% include "playground/_tool_lab_llm_config_modal.html" %}

    <!-- Bootstrap 5 JS Bundle -->
    <script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.3.1/js/bootstrap.bundle.min.js"></script>
    <!-- Syntax Highlighting -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script>
        (function () {
            function highlightArticle() {
                var blocks = document.querySelectorAll('.markdown-body pre code');
                if (!blocks || !blocks.length) return;
                blocks.forEach(function (block) { try { hljs.highlightElement(block); } catch (e) {} });
            }
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', highlightArticle);
            } else {
                highlightArticle();
            }
        })();
    </script>
    <script>
        // ä¸»é¢˜åˆ‡æ¢æŒ‰é’®
        (function () {
            function setIcon(theme) {
                var el = document.querySelector('#themeToggle .theme-icon');
                if (!el) return;
                el.textContent = theme === 'dark' ? 'â˜€ï¸' : 'ğŸŒ™';
            }
            function getTheme() {
                return document.documentElement.getAttribute('data-theme') || 'light';
            }
            setIcon(getTheme());
            var btn = document.getElementById('themeToggle');
            if (!btn) return;
            btn.addEventListener('click', function () {
                var cur = getTheme();
                var next = cur === 'dark' ? 'light' : 'dark';
                document.documentElement.classList.add('theme-transitioning');
                document.documentElement.setAttribute('data-theme', next);
                try { localStorage.setItem('theme', next); } catch (e) {}
                setIcon(next);
                setTimeout(function() {
                    document.documentElement.classList.remove('theme-transitioning');
                }, 450);
            });
        })();
    </script>
    <script>
        // å…³é—­æœ€åä¸€æ¡æç¤ºåï¼Œç§»é™¤æ•´ä¸ªæ¶ˆæ¯å®¹å™¨ï¼Œé¿å…é¡¶éƒ¨ç•™ç™½
        document.addEventListener('closed.bs.alert', function (event) {
            var container = event.target && event.target.closest
                ? event.target.closest('.messages-container')
                : null;
            if (!container) return;
            if (container.querySelectorAll('.alert').length === 0) {
                container.remove();
            }
        });
    </script>
    <!-- èµ›åšæœ‹å…‹èƒŒæ™¯åŠ¨ç”»ï¼ˆä»…æš—è‰²ä¸»é¢˜ï¼‰ -->
    <script src="{% static 'js/bg.js' %}"></script>
    {% block extra_js %}{% endblock %}
</body>
</html>
