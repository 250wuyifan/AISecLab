<!-- ÂéüÁêÜËÆ≤Ëß£Èù¢Êùø - Á¥ßÂáëÁâà -->
{% if principle %}
<style>
.principle-panel { background:var(--surface); border:1px solid var(--border-color); border-radius:6px; overflow:hidden; margin-bottom:0.5rem; }
html[data-theme="dark"] .principle-panel { border-color:rgba(99,102,241,0.2); }
.principle-header { background:linear-gradient(135deg,rgba(99,102,241,0.1),rgba(139,92,246,0.05)); padding:0.4rem 0.75rem; border-bottom:1px solid var(--border-color); cursor:pointer; display:flex; align-items:center; justify-content:space-between; transition:background 0.2s; }
.principle-header:hover { background:linear-gradient(135deg,rgba(99,102,241,0.15),rgba(139,92,246,0.1)); }
html[data-theme="dark"] .principle-header { background:linear-gradient(135deg,rgba(0,245,255,0.1),rgba(139,92,246,0.05)); }
.principle-title { display:flex; align-items:center; gap:0.4rem; font-weight:700; font-size:0.85rem; }
.principle-title-icon { width:24px; height:24px; border-radius:6px; background:rgba(99,102,241,0.15); display:flex; align-items:center; justify-content:center; font-size:0.9rem; }
html[data-theme="dark"] .principle-title-icon { background:rgba(0,245,255,0.15); }
.principle-one-liner { font-size:0.72rem; color:var(--muted); margin-top:0; padding-left:28px; }
.principle-toggle { display:flex; align-items:center; gap:0.3rem; font-size:0.72rem; color:var(--primary-color); }
html[data-theme="dark"] .principle-toggle { color:var(--neon-cyan); }
.principle-toggle svg { transition:transform 0.3s; width:14px; height:14px; }
.principle-panel.expanded .principle-toggle svg { transform:rotate(180deg); }
.principle-body { max-height:0; overflow:hidden; transition:max-height 0.4s ease-out; }
.principle-panel.expanded .principle-body { max-height:3000px; }
.principle-content { padding:0.6rem 0.75rem; }
.principle-section { margin-bottom:0.75rem; }
.principle-section:last-child { margin-bottom:0; }
.principle-section-header { display:flex; align-items:center; gap:0.3rem; margin-bottom:0.4rem; padding-bottom:0.2rem; border-bottom:1px solid var(--primary-glow); }
.principle-section-icon { font-size:0.9rem; }
.principle-section-title { font-weight:700; font-size:0.85rem; }
.attack-flow-diagram { display:flex; align-items:center; justify-content:center; flex-wrap:wrap; gap:0.3rem; padding:0.5rem; background:var(--bg-2); border-radius:6px; margin:0.4rem 0; }
html[data-theme="dark"] .attack-flow-diagram { background:rgba(0,0,0,0.3); }
.flow-step { text-align:center; padding:0.4rem 0.5rem; background:var(--surface); border-radius:6px; border:1px solid var(--border-color); min-width:80px; }
.flow-step.highlight-danger { border-color:#ef4444; background:rgba(239,68,68,0.05); }
html[data-theme="dark"] .flow-step.highlight-danger { border-color:#ef4444; background:rgba(239,68,68,0.1); }
.flow-icon { font-size:1.2rem; margin-bottom:0.2rem; }
.flow-label { font-weight:600; font-size:0.75rem; margin-bottom:0.1rem; }
.flow-desc { font-size:0.65rem; color:var(--muted); }
.flow-arrow { font-size:1rem; color:var(--muted); }
.simple-flow { padding:0.5rem; background:var(--bg-2); border-radius:6px; font-size:0.8rem; }
html[data-theme="dark"] .simple-flow { background:rgba(0,0,0,0.3); }
.code-example { background:var(--bg-2); border-radius:6px; padding:0.5rem; margin:0.4rem 0; }
html[data-theme="dark"] .code-example { background:rgba(0,0,0,0.4); }
.code-example pre { margin:0.25rem 0 0 0; white-space:pre-wrap; font-size:0.75rem; line-height:1.5; }
.code-example code { color:var(--text); }
.principle-cases,.principle-defense { margin-top:0.75rem; padding-top:0.5rem; border-top:1px solid var(--border-color); }
.principle-cases h5,.principle-defense h5 { display:flex; align-items:center; gap:0.3rem; margin-bottom:0.4rem; font-size:0.85rem; }
.principle-cases ul,.principle-defense ul { margin:0; padding-left:1.1rem; }
.principle-cases li,.principle-defense li { margin-bottom:0.25rem; font-size:0.78rem; }
.principle-references { margin-top:0.5rem; padding-top:0.4rem; border-top:1px dashed var(--border-color); }
.principle-references h6 { font-size:0.75rem; color:var(--muted); margin-bottom:0.3rem; }
.principle-references a { display:block; font-size:0.7rem; word-break:break-all; margin-bottom:0.15rem; }
@media (max-width:768px) { .attack-flow-diagram { flex-direction:column; } .flow-arrow { transform:rotate(90deg); } }
</style>

<div class="principle-panel" id="principle-panel">
    <div class="principle-header" onclick="togglePrinciple()">
        <div>
            <div class="principle-title">
                <div class="principle-title-icon">üìñ</div>
                <span>{{ principle.title }}</span>
            </div>
            <div class="principle-one-liner">{{ principle.one_liner }}</div>
        </div>
        <div class="principle-toggle">
            <span class="toggle-text">Â±ïÂºÄ</span>
            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="6 9 12 15 18 9"></polyline></svg>
        </div>
    </div>
    <div class="principle-body">
        <div class="principle-content">
            {% for section in principle.sections %}
            <div class="principle-section">
                <div class="principle-section-header">
                    <span class="principle-section-icon">{{ section.icon }}</span>
                    <span class="principle-section-title">{{ section.title }}</span>
                </div>
                <div class="principle-section-content">{{ section.content|safe }}</div>
            </div>
            {% endfor %}
            {% if principle.attack_flow %}
            <div class="principle-section">
                <div class="principle-section-header">
                    <span class="principle-section-icon">üîÑ</span>
                    <span class="principle-section-title">ÊîªÂáªÊµÅÁ®ã</span>
                </div>
                {{ principle.attack_flow|safe }}
            </div>
            {% endif %}
            {% if principle.real_cases %}
            <div class="principle-cases">
                <h5><span>üåç</span><span>ÁúüÂÆûÊ°à‰æã</span></h5>
                <ul>{% for case in principle.real_cases %}<li>{{ case }}</li>{% endfor %}</ul>
            </div>
            {% endif %}
            {% if principle.defense_tips %}
            <div class="principle-defense">
                <h5><span>üõ°Ô∏è</span><span>Èò≤Âæ°Ë¶ÅÁÇπ</span></h5>
                <ul>{% for tip in principle.defense_tips %}<li>{{ tip }}</li>{% endfor %}</ul>
            </div>
            {% endif %}
            {% if principle.references %}
            <div class="principle-references">
                <h6>üìö ÂèÇËÄÉËµÑÊñô</h6>
                {% for ref in principle.references %}
                <a href="{{ ref }}" target="_blank" rel="noopener">{{ ref }}</a>
                {% endfor %}
            </div>
            {% endif %}
        </div>
    </div>
</div>
<script>
function togglePrinciple() {
    const p = document.getElementById('principle-panel');
    const t = p.querySelector('.toggle-text');
    p.classList.toggle('expanded');
    t.textContent = p.classList.contains('expanded') ? 'Êî∂Ëµ∑' : 'Â±ïÂºÄ';
}
</script>
{% endif %}
