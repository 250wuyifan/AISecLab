{% extends "base.html" %}
{% load static %}

{% block extra_css %}
<style>
/* é«˜çº§å·¥å…·é¡µ - å…¨å±å¸ƒå±€ */
.tools-main {
    margin-left: 0 !important;
    max-width: 100% !important;
}

.tools-main ~ .sidebar,
#sidebarMenu {
    display: none !important;
}

/* å·¥å…·å¡ç‰‡ */
.tool-detail-card {
    background: var(--surface);
    border: 1px solid var(--border-color);
    border-radius: 16px;
    overflow: hidden;
    margin-bottom: 1.5rem;
}

.tool-detail-header {
    padding: 1.5rem;
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(139, 92, 246, 0.05));
    border-bottom: 1px solid var(--border-color);
}

.tool-detail-body {
    padding: 1.5rem;
}

.tool-logo {
    width: 64px;
    height: 64px;
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 2rem;
    margin-bottom: 1rem;
}

.tool-logo.pyrit { background: rgba(59, 130, 246, 0.1); }
.tool-logo.textattack { background: rgba(34, 197, 94, 0.1); }
.tool-logo.promptfoo { background: rgba(245, 158, 11, 0.1); }
.tool-logo.rebuff { background: rgba(239, 68, 68, 0.1); }

/* å®‰è£…æ­¥éª¤ */
.install-step {
    display: flex;
    gap: 1rem;
    padding: 1rem;
    border: 1px solid var(--border-color);
    border-radius: 8px;
    margin-bottom: 0.75rem;
}

.step-number {
    width: 32px;
    height: 32px;
    border-radius: 50%;
    background: var(--primary-color);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    flex-shrink: 0;
}

.step-content {
    flex: 1;
}

/* ä»£ç å— */
.code-block {
    background: #1e1e1e;
    color: #d4d4d4;
    padding: 1rem;
    border-radius: 8px;
    font-family: 'JetBrains Mono', monospace;
    font-size: 0.85rem;
    overflow-x: auto;
    position: relative;
}

.code-block .copy-btn {
    position: absolute;
    top: 0.5rem;
    right: 0.5rem;
    background: rgba(255,255,255,0.1);
    border: none;
    color: #888;
    padding: 0.25rem 0.5rem;
    border-radius: 4px;
    cursor: pointer;
}

.code-block .copy-btn:hover {
    background: rgba(255,255,255,0.2);
    color: #fff;
}

/* ç‰¹æ€§åˆ—è¡¨ */
.feature-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.feature-list li {
    padding: 0.5rem 0;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.feature-list li:last-child {
    border-bottom: none;
}

.feature-icon {
    color: #22c55e;
}

/* çŠ¶æ€æŒ‡ç¤ºå™¨ */
.tool-status {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    border-radius: 20px;
    font-size: 0.85rem;
}

.tool-status.installed {
    background: rgba(34, 197, 94, 0.1);
    color: #22c55e;
}

.tool-status.not-installed {
    background: rgba(245, 158, 11, 0.1);
    color: #f59e0b;
}
</style>
{% endblock %}

{% block content %}
<main class="tools-main">
    <div class="container py-4" style="max-width: 1200px;">
        <!-- è¿”å›æŒ‰é’® -->
        <div class="mb-3">
            <a href="{% url 'playground:redteam_index' %}" class="btn btn-outline-secondary btn-sm">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="me-1">
                    <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
                è¿”å›çº¢é˜Ÿå·¥å…·ç®±
            </a>
        </div>

        <!-- é¡µé¢æ ‡é¢˜ -->
        <div class="mb-4">
            <h1 class="d-flex align-items-center gap-3">
                <span style="font-size: 2.5rem;">ğŸ§ª</span>
                <span>é«˜çº§çº¢é˜Ÿå·¥å…·é›†æˆ</span>
            </h1>
            <p class="text-muted">
                ä¸“ä¸šçº§ AI å®‰å…¨æµ‹è¯•å·¥å…·ï¼Œæ”¯æŒè‡ªåŠ¨åŒ–æ”»å‡»ã€å¯¹æŠ—æ ·æœ¬ç”Ÿæˆç­‰é«˜çº§åŠŸèƒ½
            </p>
        </div>

        <!-- PyRIT -->
        <div class="tool-detail-card">
            <div class="tool-detail-header">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="tool-logo pyrit">ğŸ”¬</div>
                        <h3 class="mb-2">PyRIT (Python Risk Identification Tool)</h3>
                        <p class="text-muted mb-0">å¾®è½¯å¼€æºçš„ AI çº¢é˜Ÿè‡ªåŠ¨åŒ–æ¡†æ¶</p>
                    </div>
                    <span class="tool-status {{ pyrit_status }}">
                        {% if pyrit_installed %}
                        <span class="feature-icon">âœ“</span> å·²å®‰è£…
                        {% else %}
                        <span>âš </span> æœªå®‰è£…
                        {% endif %}
                    </span>
                </div>
            </div>
            <div class="tool-detail-body">
                <div class="row">
                    <div class="col-md-6">
                        <h5 class="mb-3">ä¸»è¦åŠŸèƒ½</h5>
                        <ul class="feature-list">
                            <li><span class="feature-icon">âœ“</span> è‡ªåŠ¨åŒ–æç¤ºæ³¨å…¥æµ‹è¯•</li>
                            <li><span class="feature-icon">âœ“</span> å¤šè½®å¯¹è¯æ”»å‡»ç­–ç•¥</li>
                            <li><span class="feature-icon">âœ“</span> æ”»å‡»æ ‘ç”Ÿæˆä¸éå†</li>
                            <li><span class="feature-icon">âœ“</span> æ”¯æŒå¤šç§ LLM åç«¯</li>
                            <li><span class="feature-icon">âœ“</span> å¯æ‰©å±•çš„æ”»å‡»ç­–ç•¥æ¡†æ¶</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h5 class="mb-3">å®‰è£…æ­¥éª¤</h5>
                        <div class="install-step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <strong>å®‰è£… PyRIT</strong>
                                <div class="code-block mt-2">
                                    <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                                    pip install pyrit
                                </div>
                            </div>
                        </div>
                        <div class="install-step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <strong>é…ç½®ç¯å¢ƒå˜é‡</strong>
                                <div class="code-block mt-2">
                                    <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                                    export AZURE_OPENAI_API_KEY=your_key
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                {% if pyrit_installed %}
                <hr class="my-4">
                <h5 class="mb-3">å¿«é€Ÿæµ‹è¯•</h5>
                <div class="row">
                    <div class="col-md-8">
                        <textarea class="form-control mb-2" id="pyrit-target" rows="2" placeholder="è¾“å…¥æµ‹è¯•ç›®æ ‡æˆ–ç³»ç»Ÿæç¤º..."></textarea>
                        <select class="form-select mb-2" id="pyrit-strategy">
                            <option value="crescendo">Crescendo æ¸è¿›å¼æ”»å‡»</option>
                            <option value="tree_of_attacks">æ”»å‡»æ ‘éå†</option>
                            <option value="direct">ç›´æ¥æ³¨å…¥</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-primary w-100 h-100" onclick="runPyrit()">
                            ğŸš€ è¿è¡Œæµ‹è¯•
                        </button>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- TextAttack -->
        <div class="tool-detail-card">
            <div class="tool-detail-header">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="tool-logo textattack">ğŸ“</div>
                        <h3 class="mb-2">TextAttack</h3>
                        <p class="text-muted mb-0">NLP å¯¹æŠ—æ ·æœ¬ç”Ÿæˆæ¡†æ¶</p>
                    </div>
                    <span class="tool-status {{ textattack_status }}">
                        {% if textattack_installed %}
                        <span class="feature-icon">âœ“</span> å·²å®‰è£…
                        {% else %}
                        <span>âš </span> æœªå®‰è£…
                        {% endif %}
                    </span>
                </div>
            </div>
            <div class="tool-detail-body">
                <div class="row">
                    <div class="col-md-6">
                        <h5 class="mb-3">ä¸»è¦åŠŸèƒ½</h5>
                        <ul class="feature-list">
                            <li><span class="feature-icon">âœ“</span> åŒä¹‰è¯æ›¿æ¢æ”»å‡»</li>
                            <li><span class="feature-icon">âœ“</span> å­—ç¬¦çº§æ‰°åŠ¨</li>
                            <li><span class="feature-icon">âœ“</span> è¯­ä¹‰ä¿æŒæ”»å‡»</li>
                            <li><span class="feature-icon">âœ“</span> å¤šç§é¢„å®šä¹‰æ”»å‡»æ–¹æ³•</li>
                            <li><span class="feature-icon">âœ“</span> æ”¯æŒè‡ªå®šä¹‰æ”»å‡»ç­–ç•¥</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h5 class="mb-3">å®‰è£…æ­¥éª¤</h5>
                        <div class="install-step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <strong>å®‰è£… TextAttack</strong>
                                <div class="code-block mt-2">
                                    <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                                    pip install textattack
                                </div>
                            </div>
                        </div>
                        <div class="install-step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <strong>ä¸‹è½½æ¨¡å‹å’Œæ•°æ®é›†</strong>
                                <div class="code-block mt-2">
                                    <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                                    textattack download
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                {% if textattack_installed %}
                <hr class="my-4">
                <h5 class="mb-3">å¯¹æŠ—æ ·æœ¬ç”Ÿæˆ</h5>
                <div class="row">
                    <div class="col-md-8">
                        <textarea class="form-control mb-2" id="textattack-input" rows="2" placeholder="è¾“å…¥è¦ç”Ÿæˆå¯¹æŠ—æ ·æœ¬çš„æ–‡æœ¬..."></textarea>
                        <select class="form-select mb-2" id="textattack-method">
                            <option value="textfooler">TextFooler</option>
                            <option value="bert-attack">BERT-Attack</option>
                            <option value="pwws">PWWS</option>
                            <option value="deepwordbug">DeepWordBug</option>
                        </select>
                    </div>
                    <div class="col-md-4">
                        <button class="btn btn-success w-100 h-100" onclick="runTextAttack()">
                            âš¡ ç”Ÿæˆå¯¹æŠ—æ ·æœ¬
                        </button>
                    </div>
                </div>
                {% endif %}
            </div>
        </div>

        <!-- Promptfoo -->
        <div class="tool-detail-card">
            <div class="tool-detail-header">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="tool-logo promptfoo">ğŸ§ª</div>
                        <h3 class="mb-2">Promptfoo</h3>
                        <p class="text-muted mb-0">LLM æç¤ºè¯æµ‹è¯•å’Œè¯„ä¼°æ¡†æ¶</p>
                    </div>
                    <span class="tool-status not-installed">
                        <span>âš </span> æœªå®‰è£…
                    </span>
                </div>
            </div>
            <div class="tool-detail-body">
                <div class="row">
                    <div class="col-md-6">
                        <h5 class="mb-3">ä¸»è¦åŠŸèƒ½</h5>
                        <ul class="feature-list">
                            <li><span class="feature-icon">âœ“</span> æ‰¹é‡æç¤ºè¯æµ‹è¯•</li>
                            <li><span class="feature-icon">âœ“</span> å¤šæ¨¡å‹å¯¹æ¯”è¯„ä¼°</li>
                            <li><span class="feature-icon">âœ“</span> çº¢é˜Ÿæµ‹è¯•å¥—ä»¶</li>
                            <li><span class="feature-icon">âœ“</span> å›å½’æµ‹è¯•</li>
                            <li><span class="feature-icon">âœ“</span> CI/CD é›†æˆ</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h5 class="mb-3">å®‰è£…æ­¥éª¤</h5>
                        <div class="install-step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <strong>ä½¿ç”¨ npm å®‰è£…</strong>
                                <div class="code-block mt-2">
                                    <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                                    npm install -g promptfoo
                                </div>
                            </div>
                        </div>
                        <div class="install-step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <strong>åˆå§‹åŒ–é¡¹ç›®</strong>
                                <div class="code-block mt-2">
                                    <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                                    promptfoo init
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Rebuff -->
        <div class="tool-detail-card">
            <div class="tool-detail-header">
                <div class="d-flex justify-content-between align-items-start">
                    <div>
                        <div class="tool-logo rebuff">ğŸ›¡ï¸</div>
                        <h3 class="mb-2">Rebuff</h3>
                        <p class="text-muted mb-0">æç¤ºæ³¨å…¥æ£€æµ‹ API</p>
                    </div>
                    <span class="tool-status not-installed">
                        <span>âš </span> æœªå®‰è£…
                    </span>
                </div>
            </div>
            <div class="tool-detail-body">
                <div class="row">
                    <div class="col-md-6">
                        <h5 class="mb-3">ä¸»è¦åŠŸèƒ½</h5>
                        <ul class="feature-list">
                            <li><span class="feature-icon">âœ“</span> æç¤ºæ³¨å…¥æ£€æµ‹</li>
                            <li><span class="feature-icon">âœ“</span> å¯å‘å¼è§„åˆ™æ£€æµ‹</li>
                            <li><span class="feature-icon">âœ“</span> LLM è¾…åŠ©æ£€æµ‹</li>
                            <li><span class="feature-icon">âœ“</span> å‘é‡æ•°æ®åº“ç›¸ä¼¼åº¦</li>
                            <li><span class="feature-icon">âœ“</span> Canary Token æ£€æµ‹</li>
                        </ul>
                    </div>
                    <div class="col-md-6">
                        <h5 class="mb-3">å®‰è£…æ­¥éª¤</h5>
                        <div class="install-step">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <strong>å®‰è£… Rebuff</strong>
                                <div class="code-block mt-2">
                                    <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                                    pip install rebuff
                                </div>
                            </div>
                        </div>
                        <div class="install-step">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <strong>è·å– API Key</strong>
                                <div class="code-block mt-2">
                                    <button class="copy-btn" onclick="copyCode(this)">å¤åˆ¶</button>
                                    # è®¿é—® rebuff.ai è·å– API Key
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ä½¿ç”¨æç¤º -->
        <div class="alert alert-info">
            <h5 class="alert-heading d-flex align-items-center">
                <span class="me-2">ğŸ’¡</span>
                ä½¿ç”¨æç¤º
            </h5>
            <ul class="mb-0">
                <li>è¿™äº›å·¥å…·éœ€è¦å•ç‹¬å®‰è£…ï¼Œå®‰è£…å‘½ä»¤å·²åœ¨ä¸Šæ–¹æä¾›</li>
                <li>å®‰è£…å®Œæˆååˆ·æ–°é¡µé¢ï¼ŒçŠ¶æ€ä¼šè‡ªåŠ¨æ›´æ–°</li>
                <li>éƒ¨åˆ†å·¥å…·éœ€è¦é¢å¤–çš„ API Key æˆ–æ¨¡å‹ä¸‹è½½</li>
                <li>å»ºè®®åœ¨è™šæ‹Ÿç¯å¢ƒä¸­å®‰è£…è¿™äº›å·¥å…·</li>
            </ul>
        </div>
    </div>
</main>

<script>
function copyCode(btn) {
    const codeBlock = btn.parentElement;
    const code = codeBlock.textContent.replace('å¤åˆ¶', '').trim();
    navigator.clipboard.writeText(code);
    btn.textContent = 'å·²å¤åˆ¶';
    setTimeout(() => btn.textContent = 'å¤åˆ¶', 1500);
}

function runPyrit() {
    alert('PyRIT æµ‹è¯•åŠŸèƒ½å¼€å‘ä¸­...');
}

function runTextAttack() {
    alert('TextAttack åŠŸèƒ½å¼€å‘ä¸­...');
}
</script>
{% endblock %}
