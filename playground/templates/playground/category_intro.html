{% extends "base.html" %}

{% block content %}
<main class="lab-detail-main">
    <div class="container py-4">
        <!-- 返回按钮 -->
        <div class="mb-3">
            <a href="{% url 'playground:lab_list' %}" class="btn btn-outline-secondary btn-sm lab-back-btn">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="me-1">
                    <polyline points="15 18 9 12 15 6"></polyline>
                </svg>
                返回靶场列表
            </a>
        </div>
        
        <div class="mb-4">
            <h3 class="mb-1">{{ category_title }}</h3>
            <div class="text-muted">{{ category_subtitle }}</div>
        </div>

        <div class="row g-4">
            <div class="col-lg-8">
                <div class="card shadow-sm mb-3">
                    <div class="card-header">
                        <strong>是什么</strong>
                    </div>
                    <div class="card-body">
                        <p class="mb-0">{{ category_what }}</p>
                    </div>
                </div>

                <div class="card shadow-sm mb-3">
                    <div class="card-header">
                        <strong>危害类型与严重程度</strong>
                    </div>
                    <div class="card-body">
                        <table class="table table-sm table-bordered mb-0">
                            <thead>
                                <tr>
                                    <th>危害类型</th>
                                    <th>说明</th>
                                    <th class="text-center" style="width: 6rem;">严重程度</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for h in category_harms %}
                                <tr>
                                    <td>{{ h.name }}</td>
                                    <td>{{ h.desc }}</td>
                                    <td class="text-center">{{ h.severity }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>

                {% if category_causes %}
                <div class="card shadow-sm mb-3">
                    <div class="card-header">
                        <strong>成因简述</strong>
                    </div>
                    <div class="card-body">
                        <p class="mb-0 small text-muted">{{ category_causes }}</p>
                    </div>
                </div>
                {% endif %}

                {% if category_slug == 'cswsh' %}
                {% include "playground/_category_cswsh_principle.html" %}
                {% endif %}
                {% if category_slug == 'output-security' %}
                {% include "playground/_category_output_security_principle.html" %}
                {% endif %}
                {% if category_slug == 'tool-security' %}
                {% include "playground/_category_tool_security_principle.html" %}
                {% endif %}
                {% if category_slug == 'mcp-security' %}
                {% include "playground/_category_mcp_security_principle.html" %}
                {% endif %}
            </div>

            <div class="col-lg-4">
                <div class="card shadow-sm">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <strong>本分类下的靶场（二级）</strong>
                        <span class="badge bg-secondary">{{ cases|length }}</span>
                    </div>
                    <div class="card-body p-0">
                        <ul class="list-group list-group-flush">
                            {% for it in cases %}
                            <li class="list-group-item">
                                <a href="{{ it.url }}" class="text-decoration-none fw-semibold">{{ it.title }}</a>
                                <div class="small text-muted mt-1">{{ it.subtitle }}</div>
                            </li>
                            {% empty %}
                            <li class="list-group-item text-muted small">暂无靶场 case。</li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>
{% endblock %}
